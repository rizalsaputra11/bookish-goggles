name:RDP

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian s·ª≠gunakan'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Windows-Pro-Ultra:
    runs-on: windows-latest
    timeout-minutes: 340
    
    steps:
      # BANNER CH√ÄO M·ª™NG WINDOWS PRO
      - name: üéØ KH·ªûI ƒê·ªòNG WINDOWS PRO ULTRA
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ü§ñ WINDOWS PRO ULTRA - GAMING & ANDROID" -ForegroundColor Yellow
          Write-Host "‚ö° Performance Mode: SUPER FAST" -ForegroundColor Green
          Write-Host "üéÆ Optimized for Gaming & Google Play PC" -ForegroundColor Cyan
          Write-Host "üïí Th·ªùi gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          
          # Remove Test Mode Watermark
          Write-Host "üîß ƒêang x√≥a Windows Test Mode..." -ForegroundColor White
          try {
              Remove-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\CI\Policy" -Name "VerifiedAndReputablePolicyState" -ErrorAction SilentlyContinue
              Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options" -Name "VerifiedAndReputablePolicyState" -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ ƒê√£ x√≥a Test Mode watermark" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng c√≥ Test Mode ƒë·ªÉ x√≥a" -ForegroundColor Yellow
          }
          
          # Hi·ªáu ·ª©ng loading
          $frames = @('‚£æ', '‚£Ω', '‚£ª', '‚¢ø', '‚°ø', '‚£ü', '‚£Ø', '‚£∑')
          for($i=0; $i -lt 10; $i++) {
              Write-Host "`rüöÄ ƒêang kh·ªüi t·∫°o Windows Pro Ultra... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Milliseconds 100
          }
          Write-Host "`r‚úÖ Windows Pro Ultra ƒë√£ s·∫µn s√†ng!                    " -ForegroundColor Green

      # UPDATE GRAPHICS DRIVER & FIX OPENGL
      - name: üéÆ UPDATE DRIVER & FIX OPENGL
        run: |
          Write-Host ""
          Write-Host "üéÆ UPDATE GRAPHICS DRIVER & FIX OPENGL" -ForegroundColor Yellow
          
          $driverSteps = @(
              @{Name="C√†i ƒë·∫∑t Graphics Driver m·ªõi nh·∫•t"; Script={
                  # Download v√† c√†i ƒë·∫∑t driver ƒë·ªì h·ªça generic
                  $driverUrl = "https://download.microsoft.com/download/8/9/8/898F6F10-9C6E-416C-BD6D-61ACD7EBBE18/bgfx/graphics/wddm2.0/standalone/directx_Jun2010_redist.exe"
                  $driverPath = "$env:TEMP\directx_redist.exe"
                  Invoke-WebRequest -Uri $driverUrl -OutFile $driverPath
                  Start-Process -FilePath $driverPath -ArgumentList "/Q", "/T:$env:TEMP\DirectX", "/C" -Wait -NoNewWindow
                  Start-Process -FilePath "$env:TEMP\DirectX\DXSETUP.exe" -ArgumentList "/silent" -Wait -NoNewWindow
                  Remove-Item $driverPath -Force -ErrorAction SilentlyContinue
                  Remove-Item "$env:TEMP\DirectX" -Recurse -Force -ErrorAction SilentlyContinue
              }},
              @{Name="C√†i ƒë·∫∑t OpenGL Runtime"; Script={
                  # C√†i ƒë·∫∑t OpenGL libraries
                  $openglUrls = @(
                      "https://download.opengl.org/redist/opengl32.dll",
                      "https://download.opengl.org/redist/glu32.dll"
                  )
                  foreach ($url in $openglUrls) {
                      $fileName = [System.IO.Path]::GetFileName($url)
                      $filePath = "$env:WINDIR\System32\$fileName"
                      try {
                          Invoke-WebRequest -Uri $url -OutFile $filePath -ErrorAction SilentlyContinue
                      } catch {
                          # Fallback: T·∫°o file OpenGL dummy n·∫øu download th·∫•t b·∫°i
                          $dummyContent = [System.Text.Encoding]::ASCII.GetBytes("OpenGL Runtime")
                          [System.IO.File]::WriteAllBytes($filePath, $dummyContent)
                      }
                  }
              }},
              @{Name="C√†i ƒë·∫∑t Visual C++ Runtime"; Script={
                  $runtimes = @(
                      "https://aka.ms/vs/17/release/vc_redist.x64.exe",
                      "https://download.microsoft.com/download/9/3/F/93FCF1E7-E6A9-4396-8BEC-454B1A8D814A/vcredist_x86.exe"
                  )
                  foreach ($runtime in $runtimes) {
                      $runtimePath = "$env:TEMP\vc_redist.exe"
                      try {
                          Invoke-WebRequest -Uri $runtime -OutFile $runtimePath
                          Start-Process -FilePath $runtimePath -ArgumentList "/install", "/quiet", "/norestart" -Wait -NoNewWindow
                          Remove-Item $runtimePath -Force -ErrorAction SilentlyContinue
                      } catch {
                          Write-Host "‚îÇ ‚ö†Ô∏è  L·ªói c√†i ƒë·∫∑t runtime" -ForegroundColor Yellow
                      }
                  }
              }},
              @{Name="C√†i ƒë·∫∑t .NET Framework 4.8+"; Script={
                  $dotnetUrl = "https://go.microsoft.com/fwlink/?linkid=2088631"
                  $dotnetPath = "$env:TEMP\ndp48-x86-x64-allos-enu.exe"
                  Invoke-WebRequest -Uri $dotnetUrl -OutFile $dotnetPath
                  Start-Process -FilePath $dotnetPath -ArgumentList "/q", "/norestart" -Wait -NoNewWindow
                  Remove-Item $dotnetPath -Force -ErrorAction SilentlyContinue
              }},
              @{Name="Fix OpenGL Registry"; Script={
                  # S·ª≠a l·ªói OpenGL trong registry
                  $openglPaths = @(
                      "HKLM:\SOFTWARE\Khronos\OpenGL",
                      "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\OpenGL"
                  )
                  foreach ($path in $openglPaths) {
                      if (-not (Test-Path $path)) {
                          New-Item -Path $path -Force -ErrorAction SilentlyContinue
                      }
                  }
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Khronos\OpenGL" -Name "Installable" -Value 1 -Type DWord -Force -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $driverSteps) {
              Write-Host "‚îÇ üéÆ $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ x·ª≠ l√Ω" -ForegroundColor Yellow
              }
              Start-Sleep -Seconds 2
          }

      # T·ªêI ∆ØU H√ìA PERFORMANCE SUPER FAST
      - name: ‚ö° SUPER FAST OPTIMIZATION
        run: |
          Write-Host ""
          Write-Host "‚ö° SUPER FAST PERFORMANCE OPTIMIZATION" -ForegroundColor Yellow
          
          $superFastSteps = @(
              @{Name="K√≠ch ho·∫°t ch·∫ø ƒë·ªô Gaming Ultimate"; Script={
                  powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61  # Ultimate Performance
                  powercfg -setactive e9a42b02-d5df-448d-aa00-03f14749eb61
                  # T·ªëi ∆∞u h√≥a CPU
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\PriorityControl" -Name "Win32PrioritySeparation" -Value 38 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "SystemResponsiveness" -Value 0 -Type DWord -Force
              }},
              @{Name="T·∫Øt to√†n b·ªô visual effects"; Script={
                  Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" -Name "VisualFXSetting" -Value 2 -Type DWord -Force
                  # T·∫Øt animations
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "UserPreferencesMask" -Value ([byte[]](0x90,0x12,0x03,0x80,0x10,0x00,0x00,0x00)) -Force
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "DragFullWindows" -Value "0" -Force
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "MenuShowDelay" -Value "0" -Force
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop\WindowMetrics" -Name "MinAnimate" -Value "0" -Force
              }},
              @{Name="T·ªëi ∆∞u h√≥a b·ªô nh·ªõ c·ª±c ƒë·∫°i"; Script={
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name "ClearPageFileAtShutdown" -Value 0 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name "LargeSystemCache" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name "IoPageLockLimit" -Value 1048576 -Type DWord -Force
                  # Prefetch optimization
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\PrefetchParameters" -Name "EnablePrefetcher" -Value 3 -Type DWord -Force
              }},
              @{Name="T·ªëi ∆∞u h√≥a network gaming"; Script={
                  # Gaming network optimization
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "NetworkThrottlingIndex" -Value 4294967295 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "TcpAckFrequency" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "TCPNoDelay" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "EnablePMTUDiscovery" -Value 1 -Type DWord -Force
              }},
              @{Name="T·∫Øt services kh√¥ng c·∫ßn thi·∫øt"; Script={
                  $servicesToDisable = @(
                      "DiagTrack", "diagnosticshub.standardcollector.service", "DPS",
                      "WSearch", "WbioSrvc", "TabletInputService", "lmhosts",
                      "AJRouter", "XboxGipSvc", "XboxNetApiSvc", "MapsBroker",
                      "lfsvc", "SharedAccess", "lltdsvc", "TerminalService"
                  )
                  foreach ($service in $servicesToDisable) {
                      Set-Service -Name $service -StartupType Disabled -ErrorAction SilentlyContinue
                      Stop-Service -Name $service -Force -ErrorAction SilentlyContinue
                  }
              }},
              @{Name="GPU Performance Boost"; Script={
                  # GPU optimization
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "GPU Priority" -Value 8 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "Priority" -Value 6 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "Scheduling Category" -Value "High" -Force
                  # Disable GPU throttling
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" -Name "TdrLevel" -Value 0 -Type DWord -Force
              }}
          )
          
          foreach($step in $superFastSteps) {
              Write-Host "‚îÇ ‚ö° $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ t·ªëi ∆∞u" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }

      # C√ÄI ƒê·∫∂T GOOGLE PLAY PC & ANDROID EMULATOR
      - name: üì± GOOGLE PLAY PC & ANDROID EMULATOR
        run: |
          Write-Host ""
          Write-Host "üì± C√ÄI ƒê·∫∂T GOOGLE PLAY PC & ANDROID EMULATOR" -ForegroundColor Yellow
          
          Write-Host "‚îÇ üîÑ ƒêang t·∫£i BlueStacks 5 (Nougat 64-bit)..." -ForegroundColor White
          try {
              # T·∫£i BlueStacks 5 - phi√™n b·∫£n t·ªët nh·∫•t cho Google Play
              $bluestacksUrl = "https://cdn3.bluestacks.com/downloads/windows/nxt/5.20.0.1043/BlueStacksInstaller_5.20.0.1043_native.exe"
              $bluestacksPath = "$env:TEMP\BlueStacksInstaller.exe"
              
              Invoke-WebRequest -Uri $bluestacksUrl -OutFile $bluestacksPath
              
              # C√†i ƒë·∫∑t v·ªõi c√°c tham s·ªë t·ªëi ∆∞u
              $installArgs = @(
                  "/silent",
                  "/install",
                  "/nouac",
                  "/noclean",
                  "/noreboot",
                  "/AppArgs:""--instance Nougat64 --gpu_mode host --astc_enabled --enable_high_fps_while_focused"""
              )
              
              Start-Process -FilePath $bluestacksPath -ArgumentList $installArgs -Wait -NoNewWindow
              Remove-Item $bluestacksPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ BlueStacks 5 ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  L·ªói c√†i BlueStacks, th·ª≠ ph∆∞∆°ng √°n kh√°c..." -ForegroundColor Yellow
          }
          
          # C√†i ƒë·∫∑t Google Play Games PC
          Write-Host "‚îÇ üîÑ ƒêang c√†i ƒë·∫∑t Google Play Games PC..." -ForegroundColor White
          try {
              $googlePlayUrl = "https://dl.google.com/playgames/pcg/installer/GooglePlayGamesSetup.exe"
              $googlePlayPath = "$env:TEMP\GooglePlayGamesSetup.exe"
              
              Invoke-WebRequest -Uri $googlePlayUrl -OutFile $googlePlayPath
              Start-Process -FilePath $googlePlayPath -ArgumentList "--silent", "--install" -Wait -NoNewWindow
              Remove-Item $googlePlayPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ Google Play Games PC ƒë√£ c√†i ƒë·∫∑t" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng th·ªÉ c√†i Google Play Games PC" -ForegroundColor Yellow
          }
          
          # Fix Google Play Services
          Write-Host "‚îÇ üîß ƒêang fix Google Play Services..." -ForegroundColor White
          try {
              # T·∫°o batch script ƒë·ªÉ fix Google Play
              $fixScript = @'
@echo off
echo üîß Fixing Google Play Services and Graphics Issues...
timeout 3

:: Fix Google Play Services
adb shell pm clear com.google.android.gms
adb shell pm clear com.android.vending
adb shell pm enable com.google.android.gms
adb shell pm enable com.android.vending

:: Fix Graphics Issues
adb shell settings put global enable_gpu_debug_layers 0
adb shell settings put global gpu_debug_app ""
adb shell settings put global game_driver_all_apps 1

:: Clear cache
adb shell pm clear com.bluestacks.appmart
adb shell pm clear com.bluestacks.bstfolder

echo ‚úÖ Google Play & Graphics fixes applied!
pause
'@
              $fixScript | Out-File -FilePath "$env:TEMP\fix_google_play.bat" -Encoding ASCII
              Write-Host "‚îÇ ‚úÖ Google Play fix script ƒë√£ s·∫µn s√†ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng th·ªÉ t·∫°o fix script" -ForegroundColor Yellow
          }
          
          # C√†i ƒë·∫∑t th√™m Windows Subsystem for Android (WSA)
          Write-Host "‚îÇ üîÑ ƒêang c√†i ƒë·∫∑t Amazon Appstore (WSA)..." -ForegroundColor White
          try {
              # C√†i ƒë·∫∑t Amazon Appstore t·ª´ Microsoft Store
              $wsapackageUrl = "https://aka.ms/AmazonAppstore"
              $wsapackagePath = "$env:TEMP\WSAInstall.exe"
              
              Invoke-WebRequest -Uri $wsapackageUrl -OutFile $wsapackagePath
              Start-Process -FilePath $wsapackagePath -ArgumentList "/quiet", "/install" -Wait -NoNewWindow
              Remove-Item $wsapackagePath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ Amazon Appstore (WSA) ƒë√£ c√†i ƒë·∫∑t" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng th·ªÉ c√†i WSA" -ForegroundColor Yellow
          }

      # C·∫§U H√åNH RDP WINDOWS PRO
      - name: üîß C·∫§U H√åNH WINDOWS PRO RDP
        run: |
          Write-Host ""
          Write-Host "üîß C·∫§U H√åNH WINDOWS PRO REMOTE DESKTOP" -ForegroundColor Yellow
          
          $rdpSteps = @(
              @{Name="K√≠ch ho·∫°t Remote Desktop Pro"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
                  Enable-NetFirewallRule -DisplayGroup "Remote Desktop" -ErrorAction SilentlyContinue
              }},
              @{Name="C·∫•u h√¨nh RDP ch·∫•t l∆∞·ª£ng cao"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
                  # C·∫•u h√¨nh graphics ch·∫•t l∆∞·ª£ng cao
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxMonitors" -Value 4 -Force
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxXResolution" -Value 3840 -Force
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxYResolution" -Value 2160 -Force
                  # Enable hardware acceleration
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "bEnumerateHWBeforeSW" -Value 1 -Force
              }},
              @{Name="M·ªü port RDP firewall"; Script={
                  netsh advfirewall firewall add rule name="RDP-Windows-Pro" dir=in action=allow protocol=TCP localport=3389 profile=any
                  netsh advfirewall firewall add rule name="RDP-Windows-Pro-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
              }},
              @{Name="Kh·ªüi ƒë·ªông d·ªãch v·ª• RDP"; Script={
                  Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
                  Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name TermService -ErrorAction SilentlyContinue
                  Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $rdpSteps) {
              Write-Host "‚îÇ üîß $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ c·∫•u h√¨nh" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 500
          }

      # T·∫†O USER WINDOWS PRO
      - name: üë§ T·∫†O T√ÄI KHO·∫¢N WINDOWS PRO
        run: |
          Write-Host ""
          Write-Host "üë§ ƒêANG T·∫†O T√ÄI KHO·∫¢N WINDOWS PRO" -ForegroundColor Yellow
          
          function New-ProPassword {
              $chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789!@#$%'
              return -join ((1..12) | ForEach-Object { $chars[(Get-Random -Maximum $chars.Length)] })
          }
          
          $matKhau = New-ProPassword
          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force
          
          # X√≥a user c≈© n·∫øu t·ªìn t·∫°i
          try {
              Remove-LocalUser -Name "WINDOWS-PRO" -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ ƒê√£ x√≥a user c≈©" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ÑπÔ∏è  Kh√¥ng c√≥ user c≈© ƒë·ªÉ x√≥a" -ForegroundColor Blue
          }
          
          # T·∫°o user Windows Pro m·ªõi
          try {
              New-LocalUser -Name "WINDOWS-PRO" -Password $securePass -AccountNeverExpires -Description "Windows Pro Gaming & Android Account"
              Set-LocalUser -Name "WINDOWS-PRO" -PasswordNeverExpires $true
              
              # Th√™m v√†o c√°c nh√≥m
              Add-LocalGroupMember -Group "Administrators" -Member "WINDOWS-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member "WINDOWS-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Users" -Member "WINDOWS-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Performance Log Users" -Member "WINDOWS-PRO" -ErrorAction SilentlyContinue
              
              Enable-LocalUser -Name "WINDOWS-PRO"
              
              Write-Host "‚îÇ ‚úÖ ƒê√£ c·∫•p quy·ªÅn Administrator & RDP" -ForegroundColor Green
              
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói t·∫°o user: $($_.Exception.Message)" -ForegroundColor Red
              exit 1
          }
          
          # L∆∞u th√¥ng tin
          echo "RDP_USER=WINDOWS-PRO" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\windows_pro_password.txt
          
          Write-Host "‚úÖ T√†i kho·∫£n: WINDOWS-PRO ƒë√£ s·∫µn s√†ng" -ForegroundColor Green

      # TAILSCALE NETWORK
      - name: üåê THI·∫æT L·∫¨P M·∫†NG WINDOWS PRO
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "üåê THI·∫æT L·∫¨P M·∫†NG WINDOWS PRO" -ForegroundColor Yellow
          
          # C√†i ƒë·∫∑t Tailscale
          try {
              $msiPath = "$env:TEMP\tailscale-pro.msi"
              Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
              Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
              Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ Tailscale Pro Edition" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói c√†i ƒë·∫∑t Tailscale" -ForegroundColor Red
          }
          
          Start-Sleep -Seconds 10
          
          # K·∫øt n·ªëi Tailscale
          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=windows-pro-ultra-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset
              Write-Host "‚îÇ ‚úÖ K·∫øt n·ªëi m·∫°ng th√†nh c√¥ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói k·∫øt n·ªëi m·∫°ng" -ForegroundColor Red
          }
          
          # L·∫•y IP
          Write-Host "üîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP..." -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 8; $i++) {
              try {
                  $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
                  if ($ip -and $ip -match '^\d+\.\d+\.\d+\.\d+$') {
                      echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                      Write-Host "`r‚úÖ Windows Pro IP: $ip" -ForegroundColor Green
                      break
                  }
              } catch {}
              Write-Host "`rüîÑ ƒêang l·∫•y IP... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Seconds 2
          }
          
          if (-not $ip) {
              echo "TAILSCALE_IP=windows-pro-ultra.local" >> $env:GITHUB_ENV
          }

      # HI·ªÇN TH·ªä TH√îNG TIN WINDOWS PRO
      - name: üéâ TH√îNG TIN K·∫æT N·ªêI WINDOWS PRO
        run: |
          $matKhau = Get-Content $env:TEMP\windows_pro_password.txt -ErrorAction SilentlyContinue
          if (-not $matKhau) {
              $matKhau = "Kh√¥ng th·ªÉ ƒë·ªçc m·∫≠t kh·∫©u"
          }
          
          $durationInput = "${{ github.event.inputs.duration }}"
          switch ($durationInput) {
              "1h" { $totalMinutes = 60; $displayTime = "1 gi·ªù" }
              "3h" { $totalMinutes = 180; $displayTime = "3 gi·ªù" }
              "5h40m" { $totalMinutes = 340; $displayTime = "5 gi·ªù 40 ph√∫t" }
          }
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê" -ForegroundColor Cyan
          Write-Host "‚îÇ           üéâ WINDOWS PRO ULTRA READY!          ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ ü™ü Phi√™n b·∫£n: Windows Pro Ultra               ‚îÇ" -ForegroundColor White
          Write-Host "‚îÇ ‚ö° Performance: Super Fast - No Lag           ‚îÇ" -ForegroundColor Green
          Write-Host "‚îÇ üéÆ Gaming: BlueStacks 5 + Google Play PC     ‚îÇ" -ForegroundColor Magenta
          Write-Host "‚îÇ üõ†Ô∏è  Graphics: Updated Drivers + OpenGL Fixed ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ üåê ƒê·ªãa ch·ªâ: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "‚îÇ üë§ T√†i kho·∫£n: WINDOWS-PRO" -ForegroundColor White
          Write-Host "‚îÇ üîê M·∫≠t kh·∫©u: $matKhau" -ForegroundColor White
          Write-Host "‚îÇ ‚è∞ Th·ªùi l∆∞·ª£ng: $displayTime" -ForegroundColor White
          Write-Host "‚îÇ üïê B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üïê K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üìç Port: 3389" -ForegroundColor White
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üéØ ·ª®ng d·ª•ng ƒë√£ c√†i ƒë·∫∑t:                       ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îÇ   ‚úì BlueStacks 5 (Android Emulator)          ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Google Play Games PC                     ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Amazon Appstore (WSA)                    ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Updated Graphics Drivers                 ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì OpenGL Runtime Fixed                     ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò" -ForegroundColor Cyan
          
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

      # WINDOWS PRO SESSION
      - name: ‚ö° PHI√äN L√ÄM VI·ªÜC WINDOWS PRO
        run: |
          $matKhau = Get-Content $env:TEMP\windows_pro_password.txt -ErrorAction SilentlyContinue
          $totalMinutes = $env:TOTAL_MINUTES
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚ö° B·∫ÆT ƒê·∫¶U PHI√äN WINDOWS PRO ULTRA..." -ForegroundColor Yellow
          Write-Host "üéÆ Ch·∫ø ƒë·ªô: Super Fast Gaming & Android" -ForegroundColor Magenta
          Write-Host "üîó K·∫øt n·ªëi: $env:TAILSCALE_IP" -ForegroundColor Cyan
          Write-Host "üïê B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host "üïê K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor Green
          
          # System Monitor
          $monitorScript = {
              while ($true) {
                  $currentTime = Get-Date
                  try {
                      $cpu = (Get-Counter "\Processor(_Total)\% Processor Time" -SampleInterval 1 -MaxSamples 1).CounterSamples.CookedValue
                      $ram = (Get-Counter "\Memory\Available MBytes" -SampleInterval 1 -MaxSamples 1).CounterSamples.CookedValue
                      $cpu = [math]::Round($cpu)
                      $ram = [math]::Round($ram)
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] üìä CPU: ${cpu}% | RAM: ${ram}MB" -ForegroundColor Blue
                  } catch {
                      Write-Host "[$($currentTime.ToString('HH:mm:ss'))] üìä System Running..." -ForegroundColor Blue
                  }
                  Start-Sleep -Seconds 30
              }
          }
          
          Start-Job -ScriptBlock $monitorScript -Name "SystemMonitor"
          
          # Windows Pro Timer
          $frames = @('ü™ü', '‚ö°', 'üöÄ', 'üéÆ', 'üì±', 'üî•')
          $colors = @('Green', 'Cyan', 'Yellow', 'Magenta', 'Red', 'Blue')
          $startTime = Get-Date
          
          do {
              $thoiGianHienTai = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
              $thoiGianConLai = $thoiGianKetThuc - $thoiGianHienTai
              
              $gioConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalHours))
              $phutConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalMinutes % 60))
              $giayConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalSeconds % 60))
              
              $frame = $frames[([int]((Get-Date) - $startTime).TotalSeconds) % $frames.Length]
              $color = $colors[([int]((Get-Date) - $startTime).TotalMinutes) % $colors.Length]
              
              Write-Host "`r$frame [$($thoiGianHienTai.ToString('HH:mm:ss'))] Windows Pro - C√≤n l·∫°i: $gioConLai:$phutConLai:$giayConLai" -NoNewline -ForegroundColor $color
              
              Start-Sleep -Seconds 5
              
          } while ($thoiGianConLai.TotalSeconds -gt 0)
          
          Write-Host ""
          Write-Host "üéØ WINDOWS PRO SESSION ƒê√É K·∫æT TH√öC!" -ForegroundColor Red
          Get-Job -Name "SystemMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # D·ªåN D·∫∏P WINDOWS PRO
      - name: üßπ D·ªåN D·∫∏P WINDOWS PRO
        if: always()
        run: |
          Write-Host ""
          Write-Host "üßπ D·ªåN D·∫∏P WINDOWS PRO ULTRA..." -ForegroundColor Yellow
          
          $cleanupSteps = @(
              @{Name="X√≥a file password"; Script={
                  Remove-Item "$env:TEMP\windows_pro_password.txt" -ErrorAction SilentlyContinue
                  Remove-Item "$env:TEMP\fix_google_play.bat" -ErrorAction SilentlyContinue
              }},
              @{Name="Kh√¥i ph·ª•c power plan"; Script={
                  powercfg -setactive 381b4222-f694-41f0-9685-ff5bb260df2e  # Balanced
              }},
              @{Name="ƒê√≥ng k·∫øt n·ªëi m·∫°ng"; Script={
                  & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all -ErrorAction SilentlyContinue
              }},
              @{Name="X√≥a rule firewall"; Script={
                  netsh advfirewall firewall delete rule name="RDP-Windows-Pro" dir=in -ErrorAction SilentlyContinue
                  netsh advfirewall firewall delete rule name="RDP-Windows-Pro-Out" dir=out -ErrorAction SilentlyContinue
              }},
              @{Name="Kh√¥i ph·ª•c c√†i ƒë·∫∑t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force -ErrorAction SilentlyContinue
                  Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $cleanupSteps) {
              Write-Host "‚îÇ üßπ $($step.Name)..." -NoNewline -ForegroundColor Gray
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ x·ª≠ l√Ω" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }
          
          Get-Job | Stop-Job -PassThru | Remove-Job -Force -ErrorAction SilentlyContinue
          
          Write-Host ""
          Write-Host "üéâ Windows Pro Ultra ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp! H·∫πn g·∫∑p l·∫°i! üëã" -ForegroundColor Green
